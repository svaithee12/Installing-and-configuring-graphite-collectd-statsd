1. Install Collectd

	sudo apt-get update
	sudo apt-get install collectd collectd-utils

2. Configure Collectd
	
	sudo nano /etc/collectd/collectd.conf


	and make the following changes 

		Hostname "graph_host"  // name that would appear on the dropdown of graphite

		un-comment the following 
			LoadPlugin apache
			LoadPlugin cpu
			LoadPlugin df
			LoadPlugin entropy
			LoadPlugin interface
			LoadPlugin load
			LoadPlugin memory
			LoadPlugin processes
			LoadPlugin rrdtool
			LoadPlugin users
			LoadPlugin write_graphite   // to write to graphite


		and make changes in the following definitions 
	
		<Plugin apache>
    			<Instance "Graphite">
        			URL "http://domain_name_or_IP/server-status?auto"
        			Server "apache"
    			</Instance>	
		</Plugin>

	
	<Plugin write_graphite>
    		<Node "graphing">
        		Host "localhost"
        		Port "2003"
        		Protocol "tcp"
        		LogSendErrors true
        		Prefix "collectd."
        		StoreRates true
        		AlwaysAppendDS false
        		EscapeCharacter "_"
    		</Node>
	</Plugin>	



3. configuring apache to report stats so that Apache will serve statistics at the /server-status page	

	
	sudo nano /etc/apache2/sites-available/apache2-graphite.conf


	Alias /content/ /usr/share/graphite-web/static/
    	<Location "/content/">
        SetHandler None
    	</Location>

	// add the following lines 

    	<Location "/server-status">
        SetHandler server-status
        Require all granted
    	</Location>

    	ErrorLog ${APACHE_LOG_DIR}/graphite-web_error.log


4. to configure storage schema for data coming from collectd

	sudo nano /etc/carbon/storage-schemas.conf

	add the following lines 

	[collectd]
	pattern = ^collectd.*
	retentions = 10s:1d,1m:7d,10m:1y


5. reload the services 

	sudo service carbon-cache stop          ## wait a few seconds here
	sudo service carbon-cache start


	sudo service collectd stop
	sudo service collectd start

